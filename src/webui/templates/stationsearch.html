{% extends "layout.html" %}
{% set active_page = 2 %}
{% block title %}
  Station Search
{% endblock %}
{% block content %}
  <h1>Station Search</h1>
  <hr/>
  <form>
    <div>
      <div class="d-sm-inline-block">
        <label for="txname" class="form-label"><small>name</small></label>
        <input style="min-width:15em;" type="text" id="txname" name="name" class="form-control" placeholder="Enter station name to search" value="{{ selectedname|default("", true) }}">
      </div>

      <div class="d-sm-inline-block">
        <label for="slcountry" class="form-label"><small>country</small></label>
        <select name="country" id="slcountry" class="form-control max-width-200-sm">
          <option {% if selectedcountry=="nofilter" %}selected{% endif %} value="nofilter">NO FILTER</option>
          {% for countryname, countrycode in countries.countrylist.items() %}
              <option {% if selectedcountry==countrycode %}selected{% endif %} value="{{countrycode}}" >{{countryname}} ({{countrycode}})</option>
          {% endfor %}
        </select>
      </div>

      <div class="d-sm-inline-block">
        <label for="sllang" class="form-label"><small>language</small></label>
        <select name="lang" id="sllang" class="form-control max-width-200-sm">
          <option {% if selectedlang=="nofilter" %}selected{% endif %} value="nofilter">NO FILTER</option>
          {% for languagename, languacecode in languages.languagelist.items() %}
              <option {% if selectedlang==languagename %}selected{% endif %} value="{{languagename}}" >{{languagename}}</option>
          {% endfor %}
        </select>
      </div>

      <div class="d-sm-inline-block">
        <label for="slorderby" class="form-label"><small>order by</small></label>
        <select name="orderby" id="slorderby" class="form-control">
            <option {% if orderby=="name" %}selected{% endif %} value="name">NAME</option>
            <option {% if orderby=="votes" %}selected{% endif %} value="votes">VOTES</option>
            <option {% if orderby=="clicktrend" %}selected{% endif %} value="clicktrend">CLICKTREND</option>
            <option {% if orderby=="clickcount" %}selected{% endif %} value="clickcount">CLICKS</option>
        </select>
      </div>

      <div class="d-sm-inline-block">
        <label for="slorder" class="form-label"><small>order</small></label>
        <select name="order" id="slorder" class="form-control">
          <option {% if order=="ASC" %}selected{% endif %} value="asc">ASC</option>
          <option {% if order=="DSC" %}selected{% endif %} value="desc">DSC</option>
        </select>
      </div>
      <div style="height:1em;"></div>
      <div>
        <div style="position:relative">
          <input type="hidden" id="txtags" name="tags" value="{{",".join(selectedtags)}}">
          <label for="tagsearch1" class="form-label"><small>tags  (<a class="link-primary link-underline-opacity-25 link-underline-opacity-100-hover" href="{{ url_for('taglist') }}">list</a>)</small></label>
          <div class="tag-input"> 
            <ul id="tagdisplay1">
              {% if selectedtags %}
                {% for tag in selectedtags %}
                  <li>{{tag}}<button class="deletebtn">X</button></li>
                {% endfor %} 
              {% endif %}
            </ul> 
            <input type="text" id="tagsearch1" class="form-control" placeholder="Enter tag to search" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title=" All tags must match on a station when multiple tags are selected." /> 
          </div>
          <div id="tagres1" class="tagres"></div>
        </div>
        <div style="height:1em;"></div>
          <div>
            <button type="submit" class="btn btn-secondary  align-bottom">SEARCH</button>
        </div>
      </div>
    </div>  
  </form>
  {% if stations %}
    <hr />

    <nav aria-label="Stations table navigation">
      <ul class="pagination">
        <li class="page-item">
          <a class="page-link" href="{{ url_for('stationsearch',name=selectedname, country=selectedcountry, lang=selectedlang, tags=selectedtags, orderby=orderby, order=order, page=pagelast)  }}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link" href="{{ url_for('stationsearch',name=selectedname, country=selectedcountry, lang=selectedlang, tags=selectedtags, orderby=orderby, order=order, page=pagenext)  }}" aria-label="Previous">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
    <div class="table-responsive">
      <table id="stationstable" class="table table-striped table-hover">
        <thead class="table-primary">
          <tr>
            <th scope="col" style="width:10%;">uuid</th>
            <th scope="col" style="width:10%;">name</th>
            <th scope="col" style="width:30%;">url</th>
            <th scope="col" style="width:20%;;">homepage</th>
            <th scope="col" style="width:20%;">infos</th>
          </tr>
        </thead>
        <tbody class="text-break table-group-divider">
        {% for station in stations %}
          <tr>
            <td>{{station.stationuuid}}</td>
            <td>{{station.name}}</td>
            <td>{{station.url}}</td>
            <td>{{station.homepage}}</td>
            <td>
              {% if station.votes %}
                <span class="badge text-bg-primary text-wrap">votes: {{station.votes}}</span>
              {% endif %}
              {% if station.clickcount %}
              <span class="badge text-bg-primary text-wrap">clicks: {{station.clickcount}}</span>
              {% endif %}
              {% if station.clicktrend %}
                <span class="badge text-bg-primary text-wrap">trend: {{station.clicktrend}}</span>
              {% endif %}
              {% if station.languagecodes %}
               <span class="badge text-bg-primary text-wrap">langs: {{station.languagecodes}}</span>
              {% endif %}
              {% if station.countrycode %}
                <span class="badge text-bg-primary text-wrap">countries: {{station.countrycode}}</span>
              {% endif %}
              {% if station.codec %}
                <span class="badge text-bg-primary text-wrap">codec: {{station.codec}}</span>
              {% endif %}
              {% if station.bitrate %}
                <span class="badge text-bg-primary text-wrap">bits: {{station.bitrate}}</span>
              {% endif %}
              {% if station.tags %}
                <span class="badge text-bg-primary text-wrap mt-1">tags: {{", ".join(station.tags)}}</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    <nav aria-label="Stations table navigation">
      <ul class="pagination">
        <li class="page-item">
          <a class="page-link" href="{{ url_for('stationsearch',name=selectedname, country=selectedcountry, lang=selectedlang, tags=selectedtags, orderby=orderby, order=order, page=pagelast)  }}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link" href="{{ url_for('stationsearch',name=selectedname, country=selectedcountry, lang=selectedlang, tags=selectedtags, orderby=orderby, order=order, page=pagenext)  }}" aria-label="Previous">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  {% endif %}
{% endblock %}
